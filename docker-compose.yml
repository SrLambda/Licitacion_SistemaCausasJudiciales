# ConfiguraciÃ³n global de logs para todos los servicios
x-logging: &default-logging
  driver: "json-file"
  options:
    max-size: "10m"
    max-file: "3"
    compress: "true"

services:
  #router
  gateway:
    image: traefik:v2.10.7
    container_name: gateway    
    command:
      - "--providers.docker=true"
      - "--configfile=/etc/traefik/traefik.yml"
    ports:
      - "80:80"
      - "443:443"
      - "8080:8080"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - ./generated-config/traefik.yml:/etc/traefik/traefik.yml:ro
      - ./generated-config/dynamic-config.yml:/etc/traefik/dynamic/dynamic-config.yml:ro
      - ./api-gateway/certs-local:/certs:ro
    networks:
      - frontend-network
      - backend-network
    restart: unless-stopped
    security_opt:
      - no-new-privileges
    logging: *default-logging
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: '256M'

  db-init:
    image: alpine:3.18.12
    container_name: db-init
    env_file: .env
    command:
      - sh
      - -c
      - |
        apk add --no-cache sed
        echo 'Copying MASTER scripts...'
        cp /source-scripts-master/01-schema.sql /init-target-master/
        cp /source-scripts-master/02-grants.sql.template /init-target-master/
        cp /source-scripts-master/03-triggers.sql /init-target-master/
        
        echo 'Copying SLAVE scripts...'
        cp /source-scripts-slave/init-slave.sh /init-target-slave/
        cp /source-scripts-slave/01-create-replication-user.sql.template /init-target-slave/
        
        echo 'Processing MASTER grants template...'
        sed -e 's|__MYSQL_DATABASE__|${MYSQL_DATABASE}|g' \
            -e 's|__MYSQL_MONITOR_PASSWORD__|${MYSQL_MONITOR_PASSWORD}|g' \
            -e 's|__MYSQL_MONITOR_USER__|${MYSQL_MONITOR_USER}|g' \
            -e 's|__MYSQL_REPLICATION_PASSWORD__|${MYSQL_REPLICATION_PASSWORD}|g' \
            -e 's|__MYSQL_PASSWORD__|${MYSQL_PASSWORD}|g' \
            -e 's|__MYSQL_PASSWORD_ADMIN_APP__|${MYSQL_PASSWORD_ADMIN_APP}|g' \
            -e 's|__MYSQL_PASSWORD_ABOGADO_APP__|${MYSQL_PASSWORD_ABOGADO_APP}|g' \
            -e 's|__MYSQL_PASSWORD_ASISTENTE_APP__|${MYSQL_PASSWORD_ASISTENTE_APP}|g' \
            -e 's|__MYSQL_PASSWORD_SISTEMAS_APP__|${MYSQL_PASSWORD_SISTEMAS_APP}|g' \
            -e 's|__MYSQL_PASSWORD_READONLY_APP__|${MYSQL_PASSWORD_READONLY_APP}|g' \
            /init-target-master/02-grants.sql.template > /init-target-master/02-grants.sql
        
        echo 'Processing SLAVE replication user template...'
        sed -e 's|__MYSQL_REPLICATION_PASSWORD__|${MYSQL_REPLICATION_PASSWORD}|g' \
            /init-target-slave/01-create-replication-user.sql.template > /init-target-slave/01-create-replication-user.sql
        
        echo 'Initialization scripts ready.'
    volumes:
      - ./db/master/mysql:/source-scripts-master:ro
      - ./db/slave:/source-scripts-slave:ro
      - db-master-init-scripts:/init-target-master
      - db-slave-init-scripts:/init-target-slave
    security_opt:
      - no-new-privileges
    cap_drop:
      - ALL
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: '256M'

  db-master:
    image: proyectolicitacion_admin2025_2-db-master:1.0.0
    build:
      context: ./db/master
    container_name: db-master
    env_file: .env
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD:-root}
      MYSQL_DATABASE: ${MYSQL_DATABASE:-causas_judiciales_db}
      MYSQL_USER: ${MYSQL_USER:-appuser}
      MYSQL_PASSWORD: ${MYSQL_PASSWORD:-password}
    command:
      - --server-id=1
      - --log-bin=mysql-bin
      - --binlog-do-db=${MYSQL_DATABASE:-appdb}
      - --gtid-mode=ON
      - --enforce-gtid-consistency=ON
      - --ssl-ca=/etc/mysql/certs/ca.pem
      - --ssl-cert=/etc/mysql/certs/server-cert.pem
      - --ssl-key=/etc/mysql/certs/server-key.pem
    volumes:
      - mysql-master-data:/var/lib/mysql
      - db-master-init-scripts:/docker-entrypoint-initdb.d:ro
      - ./db/certs:/etc/mysql/certs:ro
    ports:
      - "3307:3306"
    networks:
      - database-network
    restart: always
    logging: *default-logging
    healthcheck:
      test: ["CMD-SHELL", "mysqladmin ping -h localhost -uroot -p$$MYSQL_ROOT_PASSWORD || exit 1"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 30s
    depends_on:
      db-init:
        condition: service_completed_successfully
    deploy:
      resources:
        limits:
          cpus: '2.0'
          memory: '2G'
        reservations:
          cpus: '0.5'
          memory: '512M'

  db-proxy:
    image: proyectolicitacion_admin2025_2-db-proxy:1.0.0
    build:
      context: ./db/proxy
    container_name: db-proxy
    env_file: .env
    volumes:
      - ./generated-config/proxysql.cnf:/etc/proxysql/proxysql.cnf:ro
      - proxysql-data:/var/lib/proxysql
    ports:
      - "6033:6033"
      - "6032:6032"
    networks:
      - backend-network
      - database-network
    restart: always
    depends_on:
      db-master:
        condition: service_healthy
      db-slave:
        condition: service_started
    security_opt:
      - no-new-privileges
    cap_drop:
      - ALL
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: '256M'

  db-slave:
    build:
      context: ./db/slave
    container_name: db-slave
    depends_on:
      db-master:
        condition: service_healthy
      db-init:
        condition: service_completed_successfully
    env_file: .env
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD:-root}
      MYSQL_MASTER_HOST: db-master
      MYSQL_DATABASE: ${MYSQL_DATABASE:-appdb}
      MYSQL_USER: ${MYSQL_USER:-appuser}
      MYSQL_PASSWORD: ${MYSQL_PASSWORD:-password}
    command:
      - --server-id=2
      - --relay-log=mysql-relay-bin
      - --log-slave-updates=ON
      - --read-only=ON
      - --gtid-mode=ON
      - --enforce-gtid-consistency=ON
      - --ssl-ca=/etc/mysql/certs/ca.pem
      - --ssl-cert=/etc/mysql/certs/client-cert.pem
      - --ssl-key=/etc/mysql/certs/client-key.pem
    volumes:
      - mysql-slave-data:/var/lib/mysql
      - db-slave-init-scripts:/docker-entrypoint-initdb.d:ro
      - ./db/certs:/etc/mysql/certs:ro
    networks:
      - database-network
    restart: always
    deploy:
      resources:
        limits:
          cpus: '1.5'
          memory: '1.5G'
        reservations:
          cpus: '0.5'
          memory: '512M'

  redis:
    image: redis:7.4.1-alpine3.20
    container_name: redis
    command: redis-server /usr/local/etc/redis/redis.conf
    volumes:
      - redis-data:/data
      - ./generated-config/redis.conf:/usr/local/etc/redis/redis.conf:ro
    ports:
      - "6379:6379"
    networks:
      - cache-network
    environment:
      - REDIS_PASSWORD=${REDIS_PASSWORD}
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "redis-cli", "-a", "${REDIS_PASSWORD}", "ping"]
      interval: 10s
      timeout: 3s
      retries: 5
    security_opt:
      - no-new-privileges
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: '512M'
        reservations:
          cpus: '0.25'
          memory: '128M'

  redis-replica:
    image: redis:7.4.1-alpine3.20
    container_name: redis-replica
    command: redis-server /usr/local/etc/redis/redis.conf --replicaof redis 6379
    volumes:
      - redis-replica-data:/data
      - ./generated-config/redis.conf:/usr/local/etc/redis/redis.conf:ro
    depends_on:
      redis:
        condition: service_healthy
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "redis-cli", "-a", "${REDIS_PASSWORD}", "ping"]
      interval: 10s
      timeout: 3s
      retries: 5
    security_opt:
      - no-new-privileges
    cap_drop:
      - ALL
    cap_add:
      - CHOWN
      - SETUID
      - SETGID  
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: '256M'

  autenticacion:
    build:
      context: ./backend/autenticacion
    container_name: autenticacion
    environment:
      - FLASK_APP=app.py
      - FLASK_ENV=development
      - DATABASE_URL=mysql+pymysql://${MYSQL_USER}:${MYSQL_PASSWORD}@db-master:3306/${MYSQL_DATABASE}
      - REDIS_URL=redis://redis:6379/0
      - JWT_SECRET_KEY=${JWT_SECRET_KEY}
    volumes:
      - ./backend/autenticacion/app:/app
      - ./backend/common:/app/common
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=licitacion_sistemacausasjudiciales_backend-network"
      - "traefik.http.routers.auth.rule=PathPrefix(`/api/auth`)"
      - "traefik.http.routers.auth.entrypoints=websecure"
      - "traefik.http.routers.auth.tls=true"
      - "traefik.http.middlewares.auth-strip.stripprefix.prefixes=/api/auth"
      - "traefik.http.routers.auth.middlewares=rate-limit-auth@file,security-headers@file,auth-strip"
      - "traefik.http.services.auth.loadbalancer.server.port=8000"
    networks:
      - backend-network
      - database-network
      - cache-network
    restart: unless-stopped
    logging: *default-logging
    depends_on:
      db-master:
        condition: service_started
    security_opt:
      - no-new-privileges
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: '256M'

  casos:
    build:
      context: ./backend/casos
    environment:
      - FLASK_APP=app.py
      - FLASK_ENV=development
      - DATABASE_URL=mysql+pymysql://${MYSQL_USER}:${MYSQL_PASSWORD}@db-master:3306/${MYSQL_DATABASE}
      - SECRET_KEY=${CASOS_SECRET_KEY}
      - JWT_SECRET_KEY=${JWT_SECRET_KEY}
      - REDIS_URL=redis://redis:6379/1
    volumes:
      - ./backend/casos/app:/app
      - ./backend/common:/app/common
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=licitacion_sistemacausasjudiciales_backend-network"
      - "traefik.http.routers.casos.rule=PathPrefix(`/api/casos`)"
      - "traefik.http.routers.casos.entrypoints=websecure"
      - "traefik.http.routers.casos.tls=true"
      - "traefik.http.middlewares.casos-strip.stripprefix.prefixes=/api/casos"
      - "traefik.http.routers.casos.middlewares=rate-limit@file,security-headers@file,casos-strip"
      - "traefik.http.services.casos.loadbalancer.server.port=5001"
      - "traefik.http.services.casos.loadbalancer.responseForwarding.flushInterval=1ms"
      - "traefik.http.services.casos.loadbalancer.passhostheader=true"
    networks:
      - backend-network
      - database-network
      - cache-network
    restart: unless-stopped
    depends_on:
      db-master:
        condition: service_started
    deploy:
      replicas: 2
      resources:
        limits:
          cpus: '0.5'
          memory: '256M'
    security_opt:
      - no-new-privileges
    cap_drop:
      - ALL

  documentos:
    image: proyectolicitacion_admin2025_2-documentos:1.0.0
    build:
      context: ./backend/documentos
    container_name: documentos
    environment:
      - FLASK_APP=app.py
      - FLASK_ENV=development
      - DATABASE_URL=mysql+pymysql://${MYSQL_USER}:${MYSQL_PASSWORD}@db-master:3306/${MYSQL_DATABASE}
      - JWT_SECRET_KEY=${JWT_SECRET_KEY}
      - UPLOAD_FOLDER=/app/uploads
    volumes:
      - ./backend/documentos/app:/app
      - ./backend/common:/app/common
      - documentos-uploads:/app/uploads
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=licitacion_sistemacausasjudiciales_backend-network"
      - "traefik.http.routers.docs.rule=PathPrefix(`/api/documentos`)"
      - "traefik.http.routers.docs.entrypoints=websecure"
      - "traefik.http.routers.docs.tls=true"
      - "traefik.http.middlewares.docs-strip.stripprefix.prefixes=/api/documentos"
      - "traefik.http.routers.docs.middlewares=rate-limit@file,security-headers@file,docs-strip"
      - "traefik.http.services.docs.loadbalancer.server.port=8002"
    networks:
      - backend-network
      - database-network
    restart: unless-stopped
    depends_on:
      db-master:
        condition: service_started
    security_opt:
      - no-new-privileges
    cap_drop:
      - ALL
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: '256M'

  notificaciones:
    build:
      context: ./backend/notificaciones
    container_name: notificaciones
    command: sh -c "gunicorn --bind 0.0.0.0:8003 --workers 2 --timeout 180 app:app & python worker.py"
    environment:
      - FLASK_APP=app.py
      - FLASK_ENV=development
      - DATABASE_URL=mysql+pymysql://${MYSQL_USER}:${MYSQL_PASSWORD}@db-master:3306/${MYSQL_DATABASE}
      - JWT_SECRET_KEY=${JWT_SECRET_KEY}
      - REDIS_URL=redis://redis:6379/2
      - MAIL_SERVER=${MAIL_SERVER:-mailhog}
      - MAIL_PORT=${MAIL_PORT:-1025}
      - MAIL_USERNAME=${MAIL_USERNAME:-}
      - MAIL_PASSWORD=${MAIL_PASSWORD:-}
    volumes:
      - ./backend/notificaciones/app:/app
      - ./backend/common:/app/common
    networks:
      - backend-network
      - database-network
      - cache-network
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=licitacion_sistemacausasjudiciales_backend-network"
      - "traefik.http.routers.notificaciones.rule=PathPrefix(`/api/notificaciones`)"
      - "traefik.http.routers.notificaciones.entrypoints=websecure"
      - "traefik.http.routers.notificaciones.tls=true"
      - "traefik.http.middlewares.notificaciones-strip.stripprefix.prefixes=/api/notificaciones"
      - "traefik.http.routers.notificaciones.middlewares=rate-limit@file,security-headers@file,notificaciones-strip"
      - "traefik.http.services.notificaciones.loadbalancer.server.port=8003"
    depends_on:
      db-master:
        condition: service_started
    logging: *default-logging
    security_opt:
      - no-new-privileges
    cap_drop:
      - ALL
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: '512M'
        reservations:
          cpus: '0.25'
          memory: '256M'

  ia-seguridad:
    build:
      context: ./backend
      dockerfile: ia-seguridad/Dockerfile
    container_name: ia-seguridad
    env_file: .env
    environment:
      - FLASK_APP=app.py
      - FLASK_ENV=development
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=licitacion_sistemacausasjudiciales_backend-network"
      - "traefik.http.routers.ia-seguridad.rule=PathPrefix(`/api/ia-seguridad`)"
      - "traefik.http.routers.ia-seguridad.entrypoints=websecure"
      - "traefik.http.routers.ia-seguridad.tls=true"
      - "traefik.http.routers.ia-seguridad.priority=100"
      - "traefik.http.middlewares.ia-seguridad-strip.stripprefix.prefixes=/api/ia-seguridad"
      - "traefik.http.routers.ia-seguridad.middlewares=rate-limit@file,security-headers@file,ia-seguridad-strip"
      - "traefik.http.services.ia-seguridad.loadbalancer.server.port=8005"
    networks:
      - backend-network
      - monitoring-network
    restart: unless-stopped
    logging: *default-logging
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8005/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    security_opt:
      - no-new-privileges
    deploy:
      resources:
        limits:
          cpus: '1.5'
          memory: '1G'
        reservations:
          cpus: '0.5'
          memory: '256M'

  cron:
    build:
      context: ./cron
    container_name: cron
    networks:
      - backend-network
    depends_on:
      - notificaciones
    restart: unless-stopped
    security_opt:
      - no-new-privileges
    cap_drop:
      - ALL
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: '256M'

  reportes:
    image: proyectolicitacion_admin2025_2-reportes:1.0.0
    build:
      context: ./backend/reportes
    container_name: reportes
    environment:
      - FLASK_APP=app.py
      - FLASK_ENV=development
      - DATABASE_URL=mysql+pymysql://${MYSQL_USER}:${MYSQL_PASSWORD}@db-master:3306/${MYSQL_DATABASE}
      - JWT_SECRET_KEY=${JWT_SECRET_KEY}
    volumes:
      - ./backend/reportes/app:/app
      - ./backend/common:/app/common
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=licitacion_sistemacausasjudiciales_backend-network"
      - "traefik.http.routers.reportes.rule=PathPrefix(`/api/reportes`)"
      - "traefik.http.routers.reportes.entrypoints=websecure"
      - "traefik.http.routers.reportes.tls=true"
      - "traefik.http.middlewares.reportes-strip.stripprefix.prefixes=/api/reportes"
      - "traefik.http.routers.reportes.middlewares=rate-limit@file,security-headers@file,reportes-strip"
      - "traefik.http.services.reportes.loadbalancer.server.port=8004"
    networks:
      - backend-network
      - database-network
    security_opt:
      - no-new-privileges
    cap_drop:
      - ALL
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: '256M'

  frontend:
    build:
      context: ./frontend
    labels:
      # Enable Traefik for this service
      - "traefik.enable=true"
      - "traefik.docker.network=licitacion_sistemacausasjudiciales_backend-network"

      # --- HTTP Router ---
      # Rule to catch HTTP traffic for localhost
      - "traefik.http.routers.frontend-http.rule=Host(`localhost`)"
      # Define the entrypoint for this router (port 80)
      - "traefik.http.routers.frontend-http.entrypoints=web"
      
      # --- HTTPS Router (para cuando tengamos certificados) ---
      # Rule to catch HTTPS traffic for localhost
      - "traefik.http.routers.frontend-secure.rule=Host(`localhost`)"
      # Define the entrypoint for this router (port 443)
      - "traefik.http.routers.frontend-secure.entrypoints=websecure"
      # Enable TLS (HTTPS) for this router
      - "traefik.http.routers.frontend-secure.tls=true"
      # Apply security headers to frontend
      - "traefik.http.routers.frontend-secure.middlewares=security-headers@file"
      
      # Define the backend service and port for Traefik to forward traffic to
      - "traefik.http.services.frontend.loadbalancer.server.port=80"
    depends_on:
      - reportes
    networks:
      - frontend-network
      - backend-network
    restart: unless-stopped
    logging: *default-logging
    deploy:
      replicas: 2
      resources:
        limits:
          cpus: '1.0'
          memory: '512M'
        reservations:
          cpus: '0.25'
          memory: '128M'
    security_opt:
      - no-new-privileges

  prometheus:
    image: prom/prometheus:v2.47.2
    container_name: prometheus
    volumes:
      - ./generated-config/prometheus.yml:/etc/prometheus/prometheus.yml:ro
      - prometheus-data:/prometheus
    ports:
      - "9090:9090"
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
      - '--storage.tsdb.path=/prometheus'
    networks:
      - monitoring-network
    restart: unless-stopped
    security_opt:
      - no-new-privileges
    cap_drop:
      - ALL
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: '256M'


  grafana:
    image: grafana/grafana:10.1.5
    container_name: grafana
    environment:
      - GF_SECURITY_ADMIN_USER=${GRAFANA_USER:-admin}
      - GF_SECURITY_ADMIN_PASSWORD=${GRAFANA_PASSWORD:-admin}
    volumes:
      - grafana-data:/var/lib/grafana
    ports:
      - "3000:3000"
    networks:
      - monitoring-network
    restart: unless-stopped
    depends_on:
      - prometheus
    security_opt:
      - no-new-privileges
    cap_drop:
      - ALL
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: '256M'

  mailhog:
    image: mailhog/mailhog:v1.0.1
    container_name: mailhog
    ports:
      - "1025:1025"
      - "8025:8025"
    networks:
      - backend-network
    security_opt:
      - no-new-privileges
    cap_drop:
      - ALL
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: '256M'

  backup-service:
    build:
      context: ./backup-service
    container_name: backup-service
    environment:
      - MYSQL_HOST=db-master
      - MYSQL_USER=root
      - MYSQL_PASSWORD=${MYSQL_ROOT_PASSWORD:-root_password_2025}
      - MYSQL_DATABASE=${MYSQL_DATABASE:-causas_judiciales_db}
      - BACKUP_RETENTION_DAYS=7
    volumes:
      - ./backups:/backups
      - documentos-uploads:/data/documentos:ro
    networks:
      - database-network
      - monitoring-network
    depends_on:
      - db-master
    restart: unless-stopped
    security_opt:
      - no-new-privileges
    cap_drop:
      - ALL
    cap_add:
      - CHOWN
      - DAC_OVERRIDE
      - FOWNER
      - SETUID
      - SETGID
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: '256M'

  # Auto-Failover Daemon
  failover-daemon:
    build:
      context: .
      dockerfile: monitoring/failover/Dockerfile
    container_name: failover-daemon
    env_file: .env
    command: /scripts/auto-failover-daemon.sh
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./.env:/config/.env:ro
    networks:
      - database-network
      - monitoring-network
    depends_on:
      db-master:
        condition: service_started
      db-slave:
        condition: service_started
      db-proxy:
        condition: service_started
    restart: unless-stopped
    security_opt:
      - no-new-privileges
    cap_drop:
      - ALL
    cap_add:
      - NET_RAW
      - NET_ADMIN
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: '256M'

  # Auto-Failback Daemon (opcional)
  failback-daemon:
    build:
      context: .
      dockerfile: monitoring/failover/Dockerfile
    container_name: failback-daemon
    env_file: .env
    command: /scripts/auto-failback-daemon.sh
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./.env:/config/.env:ro
    networks:
      - database-network
      - monitoring-network
    depends_on:
      db-master:
        condition: service_started
      db-slave:
        condition: service_started
      db-proxy:
        condition: service_started
    restart: unless-stopped
    profiles:
      - failback  # Solo se inicia con: docker-compose --profile failback up
    security_opt:
      - no-new-privileges
    cap_drop:
      - ALL
    cap_add:
      - NET_RAW
      - NET_ADMIN
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: '256M'

networks:
  frontend-network:
    driver: bridge
    ipam:
      config:
        - subnet: 172.20.0.0/24
  
  backend-network:
    driver: bridge
    ipam:
      config:
        - subnet: 172.21.0.0/24
  
  database-network:
    driver: bridge
    ipam:
      config:
        - subnet: 172.22.0.0/24
  
  cache-network:
    driver: bridge
    ipam:
      config:
        - subnet: 172.23.0.0/24
  
  monitoring-network:
    driver: bridge
    ipam:
      config:
        - subnet: 172.24.0.0/24

volumes:
  mysql-master-data:
  mysql-slave-data:
  redis-data:
  redis-replica-data:
  documentos-uploads:
  prometheus-data:
  prometheus-config:
  grafana-data:
  frontend-node-modules:
  db-master-init-scripts: {}
  db-slave-init-scripts: {}
  redis-config:
  proxysql-config:
  proxysql-data:
  traefik-config:
