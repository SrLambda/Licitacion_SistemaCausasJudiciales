server {
  listen 80;
  server_name localhost;

  root /usr/share/nginx/html;
  index index.html index.htm;

  # =========================================================
  # OPTIMIZACIÓN DE RENDIMIENTO
  # =========================================================

  # 1. Compresión Gzip (Reduce drásticamente el uso de ancho de banda)
  gzip on;
  gzip_vary on;
  gzip_min_length 10240;
  gzip_proxied expired no-cache no-store private auth;
  gzip_types text/plain text/css text/xml text/javascript application/x-javascript application/xml application/javascript;
  gzip_disable "MSIE [1-6]\.";

  # 2. Buffers y Timeouts (Evita que el servidor se sature con conexiones lentas)
  client_body_buffer_size 10K;
  client_header_buffer_size 1k;
  client_max_body_size 8m;
  large_client_header_buffers 2 1k;
  client_body_timeout 12;
  client_header_timeout 12;
  keepalive_timeout 15;
  send_timeout 10;

  # =========================================================
  # CONFIGURACIÓN DE CACHÉ (SPA REACT)
  # =========================================================

  # Archivos estáticos con Hash (JS, CSS, Media generados por webpack)
  # Estos archivos nunca cambian de contenido si cambia el nombre, cachear por 1 año.
  location ~* \.(?:css|js|jpg|svg|png|gif|ico|woff|woff2|ttf)$ {
      expires 1y;
      add_header Cache-Control "public, max-age=31536000, immutable";
      access_log off;
  }

  # El archivo index.html NO debe cachearse (o por muy poco tiempo)
  # para asegurar que los usuarios reciban nuevas versiones de la app.
  location / {
    try_files $uri $uri/ /index.html;
    add_header Cache-Control "no-store, no-cache, must-revalidate";
  }

  # =========================================================
  # SEGURIDAD
  # =========================================================
  add_header X-Frame-Options "SAMEORIGIN";
  add_header X-Content-Type-Options "nosniff";
  add_header X-XSS-Protection "1; mode=block";
  
  # Ocultar versión de Nginx
  server_tokens off;
}